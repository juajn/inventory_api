services:
  api:
    build: .
    container_name: fastapi_inventory
    restart: always
    
    ports:
      - "8050:8050"

    volumes:
      - .:/app

    environment:
      DATABASE_URL: ${DATABASE_URL}
      SECRET_KEY: ${SECRET_KEY}
      ACCESS_TOKEN_EXPIRE_MINUTES: ${ACCESS_TOKEN_EXPIRE_MINUTES}
      ALGORITHM: ${ALGORITHM}

    labels:
      - "traefik.enable=true"

      # Router FASTAPI â€” usa TU dominio real
      - "traefik.http.routers.inventoryapi.rule=Host(`inventoryapi.adsodigital.sbs`)"
      - "traefik.http.routers.inventoryapi.entrypoints=websecure"
      - "traefik.http.routers.inventoryapi.tls=true"

      # Middleware CORS â€” aquÃ­ estÃ¡ la magia ðŸ”¥
      - "traefik.http.middlewares.inventory-cors.headers.accessControlAllowOriginList=https://frontinventory.adsodigital.sbs"
      - "traefik.http.middlewares.inventory-cors.headers.accessControlAllowMethods=GET,POST,PUT,DELETE,OPTIONS,PATCH"
      - "traefik.http.middlewares.inventory-cors.headers.accessControlAllowHeaders=*"
      - "traefik.http.middlewares.inventory-cors.headers.accessControlAllowCredentials=true"

      # Se enlaza el middleware al router
      - "traefik.http.routers.inventoryapi.middlewares=inventory-cors"

      # Puerto interno del contenedor
      - "traefik.http.services.inventoryapi.loadbalancer.server.port=8050"
